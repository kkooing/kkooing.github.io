{%- comment -%}
<!--
  ** Input parameters **
    url     = Target url.
              
  ** Url format **
    /abc/def(/*)
-->
{%- endcomment -%}
{%- assign url = include.url -%}
{%- assign url-begin = url | slice: 0 -%}

{%- if url-begin == "/" -%}
  {%- assign url = url | remove_first: "/" -%}
{%- endif -%}

{%- assign cat-array = url | append: "/" | split: "/" -%}

{%- if cat-array.size == 0 -%}
  {%- assign filtered-posts = site.posts -%}
{%- else -%}
  {%- assign cat_num = cat-array.size | minus: 1 -%}
  
  {%- assign filtered-posts = site.posts | where:"categories", cat-array[0] -%}
  {%- for i in (1..cat_num) -%}
    {%- assign filtered-posts = filtered-posts | where:"categories", cat-array[i] -%}
  {%- endfor -%}
{%- endif -%}

<div class="m-posts-stream">
  <ul id="posts-stream">
    {%- for post in filtered-posts -%}
    <li class="posts-stream-item">
      <div class="gr-thumbnail">
        <a href="{{ post.url }}">
          <img src="{{ post.thumbnail }}" alt="thumbnail"/>
        </a>
      </div>
      <div class="gr-title">
        <a href="{{ post.url }}">{{- post.title -}}</a>
      </div>
      <div class="gr-info">
        {%- include svg/schedule_black_24dp.svg -%}
        <span class="posted-date">&#39;{{- post.date | date: "%y. %-m. %-d." | -}}</span>&nbsp;
        {%- include svg/mode_comment_black_24dp.svg -%}
        <span class="comment-count">0</span>

        {%- capture breadcrumbs-text -%}
          {%- include_cached breadcrumbs.html list=site.data.navi.categories url=post.url url-now=page.url mode="plain-comp" -%}
        {%- endcapture -%}
        {% assign num-bct = breadcrumbs-text | strip_html | size %}

        {%- if num-bct != 0 -%}
          &nbsp;{%- include svg/label_black_24dp.svg -%}
          {{ breadcrumbs-text }}
        {%- endif -%}
      </div>
    </li>
    {%- endfor -%}
  </ul>
</div>

<div class="pagination", id="pagination">
</div>

<style>
  .pagination {
    text-align: center;
  }
  .btn-pagination {
    line-height: 1.45;
    padding: 0 0.5em;
    margin: 0.5em;
  }
</style>

<script>
  var dataPerPage = Number('{{site.dataPerPage}}');
  var pageButtonCount = Number('{{site.pageButtonCount}}');

  var dataCount = Number('{{filtered-posts.size}}');
  var pageCount = Math.ceil(dataCount / dataPerPage);    // 총 페이지 수

  var pagination = document.getElementById("pagination");
  pagination.querySelectorAll('*').forEach( n => n.remove() );
  for (let i = 0; i < pageCount; i++) {
    var button = document.createElement("button");
    var btn_class = document.createAttribute("class");
    var btn_onclick = document.createAttribute("onclick");
    btn_class.value = "btn-pagination";
    btn_onclick.value = "gotoPage(" + (i+1) + ")";
    button.setAttributeNode(btn_class);
    button.setAttributeNode(btn_onclick);
    button.appendChild(document.createTextNode(i+1));
    pagination.appendChild(button);
  }

  var posts_stream = document.getElementById("posts-stream");
  var x = posts_stream.getElementsByClassName("posts-stream-item");

  gotoPage(1);

  function gotoPage(page) {
    for (let k of x) {
      var li_style = document.createAttribute("style");
      li_style.value = "display: none;";
      k.setAttributeNode(li_style);
    }

    var data_begin = (page - 1) * dataPerPage;
    var data_end = (page * dataPerPage) - 1;
    if (data_end >= dataCount) { data_end = dataCount - 1 }

    for (let j = data_begin; j < data_end + 1; j++) {
      var li_style2 = document.createAttribute("style");
      li_style2.value = "display: grid;";
      x[j].setAttributeNode(li_style2);
    }

    
  }
</script>